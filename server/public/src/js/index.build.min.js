!function(){return function t(e,n,r){function o(s,c){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[s]={exports:{}};e[s][0].call(p.exports,function(t){return o(e[s][1][t]||t)},p,p.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}}()({1:[function(t,e,n){e.exports={parse:t("./lib/parse"),stringify:t("./lib/stringify")}},{"./lib/parse":3,"./lib/stringify":4}],2:[function(t,e,n){var r=/([\w-]+)|['"]{1}([^'"]*)['"]{1}/g,o=Object.create?Object.create(null):{};o.area=!0,o.base=!0,o.br=!0,o.col=!0,o.embed=!0,o.hr=!0,o.img=!0,o.input=!0,o.keygen=!0,o.link=!0,o.menuitem=!0,o.meta=!0,o.param=!0,o.source=!0,o.track=!0,o.wbr=!0,e.exports=function(t){var e,n=0,i={type:"tag",name:"",voidElement:!1,attrs:{},children:[]};return t.replace(r,function(r){n%2?e=r:0===n?((o[r]||"/"===t.charAt(t.length-2))&&(i.voidElement=!0),i.name=r):i.attrs[e]=r.replace(/['"]/g,""),n++}),i}},{}],3:[function(t,e,n){var r=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,o=t("./parse-tag"),i=Object.create?Object.create(null):{};e.exports=function(t,e){e||(e={}),e.components||(e.components=i);var n,s=[],c=-1,a=[],u={},p=!1;return t.replace(r,function(r,i){if(p){if(r!=="</"+n.name+">")return;p=!1}var h,f="/"!==r.charAt(1),l=i+r.length,m=t.charAt(l);if(f&&(c++,"tag"===(n=o(r)).type&&e.components[n.name]&&(n.type="component",p=!0),n.voidElement||p||!m||"<"===m||n.children.push({type:"text",content:t.slice(l,t.indexOf("<",l))}),u[n.tagName]=n,0===c&&s.push(n),(h=a[c-1])&&h.children.push(n),a[c]=n),(!f||n.voidElement)&&(c--,!p&&"<"!==m&&m)){h=-1===c?s:a[c].children;var d=t.indexOf("<",l),g=t.slice(l,-1===d?void 0:d);/^\s*$/.test(g)||h.push({type:"text",content:g})}}),s}},{"./parse-tag":2}],4:[function(t,e,n){function r(t,e){switch(e.type){case"text":return t+e.content;case"tag":return t+="<"+e.name+(e.attrs?function(t){var e=[];for(var n in t)e.push(n+'="'+t[n]+'"');return e.length?" "+e.join(" "):""}(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?t:t+e.children.reduce(r,"")+"</"+e.name+">"}}e.exports=function(t){return t.reduce(function(t,e){return t+r("",e)},"")}},{}],5:[function(t,e,n){const r=t("./libs/juel"),o=t("./libs/parser"),i=t("./libs/evaluator"),s=t("./libs/template"),c=t("./libs/cache"),a=t("./libs/scope");(n={}).template=s,n.cache=c,n.get=c.get,n.append=function(t,e,r,o){var i=null;if(!t||"string"!=typeof t||"string"!=typeof e)throw new Error("missing arguments");return t=document.querySelector(t),(i=n.create(e,r,o)).static(t)?Array.prototype.forEach.call(i.toHTML().childNodes,function(e){t.append(e)}):t.append(i.toHTML()),i},n.create=function(t,e,n){var c,a=null,u=null;if("string"!=typeof t||"object"!=typeof e||n&&"object"!=typeof n)throw new Error("missing arguments");if(!(u=s.get(t)))throw new Error("empty html");return a=(c=o(u)).scripts.length>0?i(c,e,n):null,r(c,a)},n.scope=function(t){if("object"!=typeof t)throw new Error("parameter must be an object");return a(t)},e.exports=n},{"./libs/cache":6,"./libs/evaluator":8,"./libs/juel":9,"./libs/parser":13,"./libs/scope":16,"./libs/template":18}],6:[function(t,e,n){var r={};(n={}).set=function(t){r[t.id]=t},n.get=function(t){return r[t]},n.delete=function(t){delete r[t]},n.clear=function(){r={}},n.list=function(){return Object.keys(r).map(function(t){return n.get(t)})},e.exports=n},{}],7:[function(t,e,n){const r=t("../scope");function o(t,e,n){var o=this;this.scope=r(e),this.common=n,this.scripts=t.scripts,this.params=null,this.scope.onChange(function(t,e){o.refresh(t,e)})}o.prototype.refresh=function(t,e){var n=this;return this.params=this.scope.keys.map(function(t){return" var "+t+" = scope."+t+";"}).join(" "),this.common&&(this.params=this.params.concat(Object.keys(this.common).map(function(t){return" var "+t+" = common."+t+";"}).join(" "))),this.scripts.forEach(function(e){t&&!e.exist(t)||e.refresh(n)}),this},e.exports=o},{"../scope":16}],8:[function(t,e,n){const r=t("./evaluator.js");e.exports=function(t,e,n){return new r(t,e,n).refresh()}},{"./evaluator.js":7}],9:[function(t,e,n){const r=t("./juel.js");e.exports=function(t,e){return new r(t,e)}},{"./juel.js":10}],10:[function(t,e,n){const r=t("../cache");function o(t,e){this.id=null,this.parsered=t,this.evaluated=e,Object.defineProperties(this,{scope:{get:function(){return this.evaluated.scope}}})}o.prototype.toHTML=function(){return this.parsered.toHTML()},o.prototype.static=function(t){return this.parsered.static(t)},o.prototype.setId=function(t){return this.id=t,r.set(this),this},e.exports=o},{"../cache":6}],11:[function(t,e,n){const r=t("../juel/juel.js"),o=t("./attribute.js");function i(t,e){var n=this;this.type=t.type,this.content=t.content,this.name=t.name,this.script=t.script,this.parent=t.parent,this.oldHtml=null,this.children=[],this.attrs=[],this.static=null,Object.defineProperties(this,{html:{get:function(){return this._html},set:function(t){this.script?(this.oldHtml=this._html||[],this._html=Array.prototype.map.call(t.childNodes,function(t){return t})):this._html=t}}}),t.script&&t.script.onChange(function(){var t=n.toHTML(),e=n.oldHtml[0];e||n.parent.children.forEach(function(t){t.script||e||(e=t.html),t==n&&(e=null)}),t.forEach(function(t){e?e.before(t):n.parent.html.append(t)}),n.oldHtml.forEach(function(t){t.remove()})}),t.attrs&&(this.attrs=Object.keys(t.attrs).map(function(r){var i=new o(r,t.attrs[r],e);return i.parts.forEach(function(t){t.script&&t.script.onChange(function(){n.html&&n.setAttribute(i.key)})}),i})),(t.children||[]).forEach(function(t){"text"==t.type?(e.scripts.forEach(function(r){var o=t.content.indexOf(r.original);if(o>-1){var s=t.content.substr(0,o);s&&n.children.push(new i({type:"text",content:s},e)),n.children.push(new i({type:"script",script:r,parent:n},e)),t.content=t.content.substr(o+r.original.length)}}),t.content&&n.children.push(new i({type:"text",content:t.content},e))):n.children.push(new i(t,e))})}i.prototype.render=function(){var t=null;if("text"==this.type)t=document.createTextNode(this.content);else if("script"==this.type){var e=this.script.value;t=document.createElement("container"),"string"==typeof e?t.append(document.createTextNode(e)):"object"==typeof e?e instanceof Array?e.forEach(function(e){e instanceof r?t.append(e.toHTML()):t.append(e)}):e instanceof r?t.append(e.toHTML()):t.append(e):t.append(document.createTextNode(e))}else t=this.static||document.createElement(this.name);return t},i.prototype.setAttribute=function(t){var e=this;this.attrs.forEach(function(n){null!=t&&n.key!=t||(n.setEvent(),n.event.key?(n.event.oldFn&&e.html.removeEventListener(n.event.key,n.event.oldFn),n.event.fn&&e.html.addEventListener(n.event.key,n.event.fn)):e.html.setAttribute(n.key,n.value()))})},i.prototype.toHTML=function(){var t=this;return this.html=this.render(),this.setAttribute(),this.children.forEach(function(e){e.script?e.toHTML().forEach(function(e){t.html.append(e)}):t.html.append(e.toHTML())}),this.html},e.exports=i},{"../juel/juel.js":10,"./attribute.js":12}],12:[function(t,e,n){function r(t,e,n,o){var i=this;this.key=t,this._value=e,this.script=o,this.parsered=n,this.parts=[],this.event={key:null,fn:null,oldFn:null},t&&n.scripts.forEach(function(t){var e=i._value.indexOf(t.original);if(e>-1){var n=i._value.substr(0,e);n&&i.parts.push(new r(null,n)),i.parts.push(new r(null,n,null,t)),i._value=i._value.substr(e+t.original.length)}})}r.prototype.value=function(){var t="";return this.parts.length?(this.parts.forEach(function(e){e.script?t+=e.script.value.toString():t+=e._value}),t+=this._value):t=this._value,t},r.prototype.setEvent=function(){1==this.parts.length&&"function"==typeof this.parts[0].script.value?(this.event.key=this.key,this.event.oldFn=this.fn,this.event.fn=this.parts[0].script.value):(this.oldFn=this.fn,this.fn=null)},e.exports=r},{}],13:[function(t,e,n){const r=t("./parser.js");e.exports=function(t){return new r(t)}},{"./parser.js":14}],14:[function(t,e,n){const r=t("html-parse-stringify"),o=t("./script.js"),i=t("./ast.js");function s(t){this.text=t,this.scripts=(this.text.match(new RegExp("(?:{{)(.*?)(?:}})","ig"))||[]).filter(function(t,e,n){return n.indexOf(t)===e}).map(function(t){return new o(t)}),this.ast=new i(r.parse(this.text)[0],this)}s.prototype.toHTML=function(){return this.ast.toHTML()},s.prototype.static=function(t){return"juel"==this.ast.name&&(this.ast.static=t,!0)},e.exports=s},{"./ast.js":11,"./script.js":15,"html-parse-stringify":1}],15:[function(t,e,n){function r(t){this.original=t,this.text=this.original.replace(new RegExp("({{)|(}})","g"),"").replace(new RegExp("&gt;"),">").replace(new RegExp("&lt;"),">"),this.value=null,this.first=!1,this.events={onChange:[]}}r.prototype.onChange=function(t){this.events.onChange.push(t)},r.prototype.exist=function(t){return this.text.indexOf(t)>-1},r.prototype.refresh=function(t){var e=this,n=new Function("scope","common","original","script",t.params+' try { return eval(script); } catch(err) { console.log(err); return ""; }')(t.scope,t.common,this.original,this.text);n!=this.value&&(this.value=n,this.first?this.events.onChange.forEach(function(t){t(e)}):this.first=!0)},e.exports=r},{}],16:[function(t,e,n){const r=t("./scope.js");e.exports=function(t){return t instanceof r?t:new r(t)}},{"./scope.js":17}],17:[function(t,e,n){function r(t){var e=this;this.keys=Object.keys(t),this.events={onChange:[]},this.keys.forEach(function(n){var r="_"+n;e[r]=t[n],Object.defineProperty(e,n,{get:function(){return e[r]},set:function(t){e[r]=t,e.events.onChange.forEach(function(e){e(n,t)})}})}),this.keys.forEach(function(n){Object.defineProperty(t,n,{get:function(){return e[n]},set:function(t){e[n]=t}})})}r.prototype.onChange=function(t){this.events.onChange.push(t)},r.prototype.toJSON=function t(e){var n={};if(void 0!==e)e instanceof r&&(n=e.toJSON()),e instanceof Array?n=e.map(function(e){return t(e)}):"object"==typeof e?(Object.keys(e).forEach(function(r){n[r]=t(e[r])}),Object.getOwnPropertyNames(e).forEach(function(r){n[r]=t(e[r])})):n=e;else if(this instanceof r){var o=this;this.keys.forEach(function(e){n[e]=t(o["_"+e])})}return n},e.exports=r},{}],18:[function(t,e,n){var r={};(n={}).set=function(t,e){if("object"==typeof t&&t instanceof Array)t.forEach(function(t){n.set(t.name,t.html)});else if("string"==typeof t&&"string"==typeof e)r[t]=e;else if(!t)throw new Error("missing arguments")},n.read=function(){var t=document.querySelectorAll("[juel]");Array.prototype.forEach.call(t,function(t){n.set(t.getAttribute("juel"),t.innerHTML.trim()),t.remove()})},n.get=function(t){return r[t]||""},e.exports=n},{}],19:[function(t,e,n){const r=t("./libs/options"),o=t("./libs/jueue");n={set:function(t,e){"object"==typeof t?(r.running=t.running||r.running,r.pauseTime=t.pauseTime||r.pauseTime):"string"==typeof t&&(r[t]=e)},get:function(t){return new o(t instanceof Array?t:Array.prototype.map.call(arguments,function(t){return t}))},promise:function(){var t=arguments;return new Promise(function(e,r){n.get.apply({},t).then(e).catch(r)})}};e.exports=n},{"./libs/jueue":20,"./libs/options":21}],20:[function(t,e,n){const r=t("./options");function o(t){var e=null,n=null,o={},i=0;Object.defineProperties(this,{next:{get:function(){return function(t){o.next(t)}}},throw:{get:function(){return e},set:function(t){"function"==typeof t&&(e=t)}},done:{get:function(){return n},set:function(t){"function"==typeof t&&(n=t)}}}),Object.defineProperties(o,{next:{get:function(){return function(e){setTimeout(function n(){if(r.running){var s={};"object"==typeof e?s=e:"string"==typeof e?s.name=e:"number"==typeof e&&(s.step=e);var c=s.step,a=s.name,u=s.model,p=s.args;if(null!=c?i=c:a?i=t.map(function(t){return t.name==a}).indexOf(!0):i++,t[i])try{o.model=null==u?null:u,p?(p.unshift(o),t[i].apply(o,p)):t[i](o)}catch(t){o.throw(t)}else o.throw(new Error("No item in progress."))}else setTimeout(n,r.pauseTime)},0)}}},throw:{get:function(){return e||function(){}}},done:{get:function(){return n||function(){}}}}),setTimeout(function(){o.next({step:0})},0)}o.prototype.then=function(t){return this.done=t,this},o.prototype.catch=function(t){return this.throw=t,this},e.exports=o},{"./options":21}],21:[function(t,e,n){e.exports={running:!0,pauseTime:1e3}},{}],22:[function(t,e,n){const r=t("juel"),o=t("jueue");var i=$("#refreshBtn"),s=$("#addBtn"),c=$("#scoreNbr"),a=$("#userNameTxt"),u=$("#currentUserFld"),p=r.scope({leaders:[],own:[]});function h(){return o.promise(t=>{d("/user/get",{userName:a.val()}).then(e=>{e.status?e.data?(f(e.data),t.done(e.data)):t.next():t.throw(new Error(e.message))}).catch(t.throw)},t=>{d("/user/add",{userName:a.val(),age:Math.floor(63*Math.random())}).then(e=>{e.status?(f(e.data),t.done(e.data)):t.throw(new Error(e.message))})})}function f(t){t?u.text("Current User: "+t.userName):u.text("Current User")}function l(){return o.promise(t=>{h().then(e=>{t.user=e,t.next()}).catch(t.throw)},t=>{d("/score/list",{userId:t.user.userId}).then(e=>{e.status?(p.leaders=e.data.leaders,p.own=e.data.own,t.done()):t.throw(new Error(e.message))}).catch(t.throw)})}function m(t,e){$.notify({icon:"add_alert",message:t},{type:e||"info",timer:3e3,placement:{from:"top",align:"center"}})}function d(t,e){return o.promise(n=>{$.ajax({url:t,method:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(e||{})}).done(function(t){n.done(t)}).fail(function(t,e){n.throw(new Error(e))})})}r.template.read(),r.append("#usersCntr","users",p,{items:function(t,e){return t.concat(e.length>0?[{rank:"...",rankChanges:"...",userName:"...",score:"...",age:"...",userId:"..."}]:[]).concat(e).map(t=>r.create("user",t,{hide:function(e){return 1==e?t.rankChanges>0?"":"d-none":0==e?0==t.rankChanges?"":"d-none":-1==e?t.rankChanges<0?"":"d-none":void 0}}).toHTML())}}),$(document).ready(function(){i.on("click",function(t){var e=(new Spinner).spin();i.append(e.el),l().then(t=>{e.el.remove()}).catch(t=>{e.el.remove(),m(t.message,"danger")})}),s.on("click",function(t){var e=(new Spinner).spin();s.append(e.el),o.promise(t=>{h().then(e=>{t.user=e,t.next()}).catch(t.throw)},t=>{d("/score/add",{userId:t.user.userId,score:Number(c.val())}).then(e=>{e.status?t.done():t.throw(new Error(e.message))}).catch(t.throw)}).then(t=>{e.el.remove()}).catch(t=>{e.el.remove(),m(t.message,"danger")})});var t=(new Spinner).spin();i.append(t.el),l().then(e=>{t.el.remove()}).catch(e=>{t.el.remove(),m(e.message,"danger")})})},{juel:5,jueue:19}]},{},[22]);